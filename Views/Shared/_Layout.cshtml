<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Ban_Caffee</title>
    <script type="importmap"></script>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/Ban_Caffee.styles.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-dyZ88n1r6AKnU8zXR0j6ozlKtyKx2Zq+caSFfbtHnFSLhd6YhS/5YyJ2Z+7e0pH7a5o6d3T3V9zzTtmI3UksdKg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link href="~/css/style.css" rel="stylesheet" />
    <link href="~/css/style_GioHang.css" rel="stylesheet" />
    <link href="~/css/styleLogin.css" rel="stylesheet" />
    <link href="~/css/styleDetail.css" rel="stylesheet" />

</head>
<body>
    <header class="header">
        <div class="logo">
            <span>My Love Coffee</span>
        </div>

        <div class="search-bar">
            <input type="text" placeholder="Tìm sản phẩm, đồ uống...">
            <button><i class="bi bi-search"></i></button>
        </div>

        <div class="header-icons">
       
            <a class="cart-button" aria-label="Xem giỏ hàng" href="@Url.Action(action: "Giohang", controller: "Cart")   ">
                 <i class="bi bi-basket"></i>
                <span class="badge">3</span>
            </a>

            <div class="dropdown">
            <button class="dropbtn">
                <i class="bi bi-person"></i>
                <i class="fas fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
                <a href="#">Thông tin cá nhân</a>
                <a href="@Url.Action("Login", "User")">Đăng nhập</a>
                <a href="#">Đăng xuất</a>
            </div>
            </div>
        </div>
    </header>

   <div class="container-fluid">
    <div class="row">

        @* Thêm dòng này ở đầu file _Layout.cshtml *@
        @inject List<DanhMuc> AllCategories


        <div class="col-12 col-lg-3 order-lg-1 px-0"> 
            <nav>
                <aside class="sidebar">
                    
                    <h3>Danh mục sản phẩm</h3> 
                    
                    <div class="list-group list-group-flush mb-3">
                        <a href="~/Home/Index" class="list-group-item list-group-item-action">Trang chủ</a>
                    </div>
                    
                    @{
                        // Nhóm các danh mục theo "loaiDm" (Đồ uống, Đồ ăn, ...)
                        var categoriesByType = AllCategories.GroupBy(dm => dm.LoaiDm);
                        int accordionCounter = 0; // Dùng để tạo ID duy nhất
                    }

                    <div class="accordion accordion-flush" id="productCategoriesAccordion">
                        
                        @foreach (var group in categoriesByType)
                        {
                            string groupId = $"flush-collapse-{accordionCounter}";
                            string headingId = $"flush-heading-{accordionCounter}";
                            
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="@headingId">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#@groupId" aria-expanded="false" aria-controls="@groupId">
                                        @group.Key  @* Đây là "Đồ uống", "Đồ ăn", "Sản phẩm khác" *@
                                    </button>
                                </h2>
                                <div id="@groupId" class="accordion-collapse collapse" aria-labelledby="@headingId" data-bs-parent="#productCategoriesAccordion">
                                    <div class="accordion-body p-0">
                                        <ul class="list-group list-group-flush">
                                            @foreach (var item in group)
                                            {
                                                <li class="list-group-item">
                                                    @* Thay đổi href theo logic của bạn, ví dụ: /Products/Category/@item.MaDm *@
                                                    <a href="#" class="text-decoration-none text-dark">
                                                        @item.TenDm @* Đây là "Cà phê", "Trà Sữa", "Bánh Ngọt",... *@
                                                    </a>
                                                </li>
                                            }
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            accordionCounter++;
                        }
                        
                    </div>
                    
                </aside>
            </nav>
        </div>


        
        <main role="main" class="col-12 col-lg-9 pb-3 order-lg-2">
            <div class="content">
                @RenderBody()
            </div>
        </main>

    </div>
</div>

   <a href="#" class="coffee-chatbot-button" aria-label="Chat với chúng tôi">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z"></path>
        </svg>
    </a>

    <script src="~/js/JS_GioHang.js"></script>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>